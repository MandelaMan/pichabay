{"ast":null,"code":"var _jsxFileName = \"C:\\\\React\\\\pichabay\\\\src\\\\context\\\\GlobalState.js\";\nimport React, { createContext, useReducer, useEffect } from \"react\";\nimport AppReducer from \"./AppReducer\";\nimport axios from \"axios\";\nimport { encryptData, decryptData, readJwt, addCookie, deleteCookie } from \"../utils/helpers\";\nimport Cookies from \"js-cookie\";\nimport { photographers } from \"../utils/data\";\nimport { createBrowserHistory } from \"history\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isLoading: false,\n  isLoggedIn: null,\n  categories: [],\n  counties: [],\n  photographers: [],\n  user_info: {}\n};\nexport const GlobalContext = /*#__PURE__*/createContext(initialState);\nexport const GlobalProvider = _ref => {\n  let {\n    children\n  } = _ref;\n  const history = createBrowserHistory();\n  const [state, dispatch] = useReducer(AppReducer, initialState);\n  const baseURL = \"http://localhost:81/kliks/v1/api\"; // const baseURL = \"https://www.pichabay.com/v1/api\";\n\n  async function fetchCategories() {\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const res = await axios.get(`${baseURL}/categories`, config);\n\n      if (res.data) {\n        dispatch({\n          type: \"GET_CATEGORIES\",\n          payload: res.data\n        });\n      }\n    } catch (error) {\n      console.log(error.message);\n    }\n  }\n\n  async function fetchPhotographers() {\n    dispatch({\n      type: \"GET_PHOTOGRAPHERS\",\n      payload: photographers\n    });\n  }\n\n  function setLoadingStatus(action) {\n    dispatch({\n      type: \"SET_LOADING_STATUS\",\n      payload: action\n    });\n  }\n\n  function setGlobalInfo(info) {\n    dispatch({\n      type: \"SET_USER_INFO\",\n      payload: info\n    });\n  }\n\n  function checkLoginStatus() {\n    let login = false;\n\n    if (localStorage.PLUD) {\n      const info = readJwt(decryptData(localStorage.PLUD));\n      login = true;\n      setGlobalInfo(info);\n    }\n\n    dispatch({\n      type: \"LOGIN_STATUS\",\n      payload: login\n    });\n  }\n\n  async function userLogin(inputs) {\n    setLoadingStatus(true);\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const res = await axios.post(`${baseURL}/users/login`, inputs, config);\n\n      if (!res.data.error) {\n        localStorage.PLUD = encryptData(res.data.token);\n        setTimeout(function () {\n          checkLoginStatus();\n          setLoadingStatus(false);\n          history.push(\"/\");\n          window.location.reload();\n        }, 200);\n      }\n    } catch (error) {}\n  }\n\n  async function userRegistration(inputs) {\n    setLoadingStatus(true);\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const res = await axios.post(`${baseURL}/users/register`, inputs, config);\n      console.log(res.data);\n\n      if (!res.data.error) {\n        localStorage.PLUD = encryptData(res.data.token);\n        setTimeout(function () {\n          checkLoginStatus();\n          setLoadingStatus(false);\n        }, 200);\n      }\n    } catch (error) {}\n  }\n\n  async function logOutUser() {\n    try {\n      localStorage.clear();\n      window.location.reload();\n      setTimeout(function () {\n        checkLoginStatus();\n      }, 200);\n    } catch (error) {\n      console.log(error.message);\n    }\n  }\n\n  async function searchPhotographer(data) {\n    setLoadingStatus(true);\n    console.log(data.location);\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const res = await axios.get(`${baseURL}/search?category=${data.category}&location=${data.location}&u_code=${data.booked_on}`, config);\n\n      if (res) {\n        console.log(res.data); // return true;\n      }\n    } catch (error) {// console.log(error.message);\n    }\n\n    history.push(\"/photographers\");\n    window.location.reload(); // setTimeout(setLoadingStatus(false), 17000);\n  }\n\n  useEffect(() => {\n    checkLoginStatus();\n    fetchCategories();\n    fetchPhotographers();\n    return () => {// cleanup;\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(GlobalContext.Provider, {\n    value: {\n      fetchCategories,\n      fetchPhotographers,\n      userLogin,\n      userRegistration,\n      setLoadingStatus,\n      logOutUser,\n      searchPhotographer,\n      photographers: state.photographers,\n      isLoggedIn: state.isLoggedIn,\n      user_info: state.user_info,\n      categories: state.categories,\n      isLoading: state.isLoading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 199,\n    columnNumber: 5\n  }, this);\n};","map":{"version":3,"sources":["C:/React/pichabay/src/context/GlobalState.js"],"names":["React","createContext","useReducer","useEffect","AppReducer","axios","encryptData","decryptData","readJwt","addCookie","deleteCookie","Cookies","photographers","createBrowserHistory","initialState","isLoading","isLoggedIn","categories","counties","user_info","GlobalContext","GlobalProvider","children","history","state","dispatch","baseURL","fetchCategories","config","headers","res","get","data","type","payload","error","console","log","message","fetchPhotographers","setLoadingStatus","action","setGlobalInfo","info","checkLoginStatus","login","localStorage","PLUD","userLogin","inputs","post","token","setTimeout","push","window","location","reload","userRegistration","logOutUser","clear","searchPhotographer","category","booked_on"],"mappings":"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","sourcesContent":["import React, { createContext, useReducer, useEffect } from \"react\";\r\nimport AppReducer from \"./AppReducer\";\r\nimport axios from \"axios\";\r\nimport {\r\n  encryptData,\r\n  decryptData,\r\n  readJwt,\r\n  addCookie,\r\n  deleteCookie,\r\n} from \"../utils/helpers\";\r\nimport Cookies from \"js-cookie\";\r\nimport { photographers } from \"../utils/data\";\r\nimport { createBrowserHistory } from \"history\";\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  isLoggedIn: null,\r\n  categories: [],\r\n  counties: [],\r\n  photographers: [],\r\n  user_info: {},\r\n};\r\n\r\nexport const GlobalContext = createContext(initialState);\r\n\r\nexport const GlobalProvider = ({ children }) => {\r\n  const history = createBrowserHistory();\r\n\r\n  const [state, dispatch] = useReducer(AppReducer, initialState);\r\n\r\n  const baseURL = \"http://localhost:81/kliks/v1/api\";\r\n  // const baseURL = \"https://www.pichabay.com/v1/api\";\r\n\r\n  async function fetchCategories() {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.get(`${baseURL}/categories`, config);\r\n\r\n      if (res.data) {\r\n        dispatch({\r\n          type: \"GET_CATEGORIES\",\r\n          payload: res.data,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.log(error.message);\r\n    }\r\n  }\r\n\r\n  async function fetchPhotographers() {\r\n    dispatch({\r\n      type: \"GET_PHOTOGRAPHERS\",\r\n      payload: photographers,\r\n    });\r\n  }\r\n\r\n  function setLoadingStatus(action) {\r\n    dispatch({\r\n      type: \"SET_LOADING_STATUS\",\r\n      payload: action,\r\n    });\r\n  }\r\n\r\n  function setGlobalInfo(info) {\r\n    dispatch({\r\n      type: \"SET_USER_INFO\",\r\n      payload: info,\r\n    });\r\n  }\r\n\r\n  function checkLoginStatus() {\r\n    let login = false;\r\n\r\n    if (localStorage.PLUD) {\r\n      const info = readJwt(decryptData(localStorage.PLUD));\r\n      login = true;\r\n      setGlobalInfo(info);\r\n    }\r\n    dispatch({\r\n      type: \"LOGIN_STATUS\",\r\n      payload: login,\r\n    });\r\n  }\r\n\r\n  async function userLogin(inputs) {\r\n    setLoadingStatus(true);\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(`${baseURL}/users/login`, inputs, config);\r\n\r\n      if (!res.data.error) {\r\n        localStorage.PLUD = encryptData(res.data.token);\r\n\r\n        setTimeout(function () {\r\n          checkLoginStatus();\r\n\r\n          setLoadingStatus(false);\r\n\r\n          history.push(\"/\");\r\n          window.location.reload();\r\n        }, 200);\r\n      }\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function userRegistration(inputs) {\r\n    setLoadingStatus(true);\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(`${baseURL}/users/register`, inputs, config);\r\n\r\n      console.log(res.data);\r\n\r\n      if (!res.data.error) {\r\n        localStorage.PLUD = encryptData(res.data.token);\r\n\r\n        setTimeout(function () {\r\n          checkLoginStatus();\r\n\r\n          setLoadingStatus(false);\r\n        }, 200);\r\n      }\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function logOutUser() {\r\n    try {\r\n      localStorage.clear();\r\n      window.location.reload();\r\n\r\n      setTimeout(function () {\r\n        checkLoginStatus();\r\n      }, 200);\r\n    } catch (error) {\r\n      console.log(error.message);\r\n    }\r\n  }\r\n\r\n  async function searchPhotographer(data) {\r\n    setLoadingStatus(true);\r\n\r\n    console.log(data.location);\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.get(\r\n        `${baseURL}/search?category=${data.category}&location=${data.location}&u_code=${data.booked_on}`,\r\n        config\r\n      );\r\n\r\n      if (res) {\r\n        console.log(res.data);\r\n        // return true;\r\n      }\r\n    } catch (error) {\r\n      // console.log(error.message);\r\n    }\r\n\r\n    history.push(\"/photographers\");\r\n    window.location.reload();\r\n\r\n    // setTimeout(setLoadingStatus(false), 17000);\r\n  }\r\n\r\n  useEffect(() => {\r\n    checkLoginStatus();\r\n\r\n    fetchCategories();\r\n    fetchPhotographers();\r\n\r\n    return () => {\r\n      // cleanup;\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <GlobalContext.Provider\r\n      value={{\r\n        fetchCategories,\r\n        fetchPhotographers,\r\n        userLogin,\r\n        userRegistration,\r\n        setLoadingStatus,\r\n        logOutUser,\r\n        searchPhotographer,\r\n\r\n        photographers: state.photographers,\r\n        isLoggedIn: state.isLoggedIn,\r\n        user_info: state.user_info,\r\n        categories: state.categories,\r\n        isLoading: state.isLoading,\r\n      }}\r\n    >\r\n      {children}\r\n    </GlobalContext.Provider>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}